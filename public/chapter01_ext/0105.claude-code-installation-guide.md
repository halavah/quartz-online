# Claude Code 安装与配置完全指南

> 从零开始安装Claude Code，包含各平台安装方法、环境变量配置、首次运行和故障排除

## 目录导航

1. [快速开始](#1-快速开始)
2. [安装方式详解](#2-安装方式详解)
3. [环境变量配置](#3-环境变量配置)
4. [首次运行配置](#4-首次运行配置)
5. [验证与故障排除](#5-验证与故障排除)

## 1. 快速开始

如果你已经迫不及待想要体验Claude Code，这里是快速安装命令：

```bash
# macOS/Linux 使用 Homebrew
brew install --cask claude-code

# 或者使用官方安装脚本
curl -fsSL https://claude.ai/install.sh | bash

# Windows PowerShell
irm https://claude.ai/install.ps1 | iex
```

> ⚠️ **注意**: 首次安装后需要配置API密钥才能使用，请继续阅读后续配置章节。

## 2. 安装方式详解

### 2.1 原生安装（推荐）

#### macOS

```bash
# 方法1: Homebrew（推荐）
brew install --cask claude-code

# 方法2: 官方脚本
curl -fsSL https://claude.ai/install.sh | bash

# 验证安装
claude --version
```

#### Linux

```bash
# 使用官方安装脚本
curl -fsSL https://claude.ai/install.sh | bash

# 添加到PATH（如果需要）
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# 验证安装
claude --version
```

#### Windows

```powershell
# 使用PowerShell
irm https://claude.ai/install.ps1 | iex

# 验证安装
claude --version
```

### 2.2 NPM 安装

```bash
# 全局安装
npm install -g @anthropic/claude-code

# 验证安装
claude --version
```

### 2.3 从 NPM 迁移到原生安装

如果你之前使用 NPM 安装，可以迁移到原生版本以获得更好的性能：

```bash
# 安装原生版本
claude install

# 查看安装位置
# Windows: C:\Users\用户名\.local\bin\claude.exe
# Linux/macOS: ~/.local/bin/claude
```

## 3. 环境变量配置

### 3.1 临时配置（测试用）

在终端中设置，仅当前会话有效：

```bash
# 设置API密钥
export ANTHROPIC_AUTH_TOKEN="你的API密钥"

# 设置自定义API端点（可选）
export ANTHROPIC_BASE_URL="https://your-api-endpoint.com"

# 启动Claude Code
claude
```

### 3.2 永久配置

#### Bash

```bash
# 添加到 ~/.bashrc
echo 'export ANTHROPIC_AUTH_TOKEN="你的API密钥"' >> ~/.bashrc
echo 'export ANTHROPIC_BASE_URL="https://your-api-endpoint.com"' >> ~/.bashrc

# 重新加载配置
source ~/.bashrc
```

#### Zsh

```bash
# 添加到 ~/.zshrc
echo 'export ANTHROPIC_AUTH_TOKEN="你的API密钥"' >> ~/.zshrc
echo 'export ANTHROPIC_BASE_URL="https://your-api-endpoint.com"' >> ~/.zshrc

# 重新加载配置
source ~/.zshrc
```

#### Windows PowerShell

```powershell
# 添加到配置文件
echo '$env:ANTHROPIC_AUTH_TOKEN="你的API密钥"' >> $PROFILE
echo '$env:ANTHROPIC_BASE_URL="https://your-api-endpoint.com"' >> $PROFILE

# 重新加载配置
. $PROFILE
```

### 3.3 查看配置

```bash
# 查看所有Anthropic相关环境变量
printenv | grep ANTHROPIC

# 或使用env命令
env | grep ANTHROPIC
```

## 4. 首次运行配置

### 4.1 启动Claude Code

```bash
# 在项目目录中启动
cd your-project
claude
```

首次启动时，Claude Code会引导你完成初始配置：

1. **选择主题** - 选择你喜欢的颜色主题
2. **确认安全须知** - 阅读并确认安全使用须知
3. **Terminal配置** - 使用默认配置或自定义
4. **信任工作目录** - 授权Claude访问当前目录

### 4.2 初始化项目

```bash
# 在项目根目录运行
claude /init

# 这会创建 CLAUDE.md 文件，包含项目信息
```

### 4.3 检查系统状态

```bash
# 运行系统检查
claude /doctor

# 查看当前配置
claude /config
```

## 5. 验证与故障排除

### 5.1 基础验证命令

```bash
# 检查版本
claude --version

# 检查安装状态
claude /doctor

# 测试API连接
claude -p "Hello, Claude!"
```

### 5.2 常见问题解决

#### 问题1: 命令未找到

```bash
# macOS/Linux
which claude
# 如果没有输出，添加到PATH
export PATH="$HOME/.local/bin:$PATH"

# Windows
Get-Command claude
# 如果没有输出，检查PATH环境变量
```

#### 问题2: API密钥错误

```bash
# 检查环境变量
echo $ANTHROPIC_AUTH_TOKEN

# 临时设置测试
export ANTHROPIC_AUTH_TOKEN="正确的密钥"
claude -p "test"
```

#### 问题3: 网络连接问题

```bash
# 测试API端点连接
curl -I https://api.anthropic.com

# 如果使用自定义端点
curl -I $ANTHROPIC_BASE_URL
```

### 5.3 清理缓存

如果遇到奇怪的缓存问题，可以清理缓存：

```bash
# 清理Claude Code缓存
rm -rf ~/.claude/cache

# 清理VSCode缓存（可选）
# macOS
rm -rf ~/Library/Application\ Support/Code/User/workspaceStorage
# Windows
rmdir /s "%APPDATA%\Code\User\workspaceStorage"
```

### 5.4 日志和调试

```bash
# 启用详细日志
claude --verbose

# 查看日志文件位置
ls ~/.claude/logs/
```

## 下一步

安装完成后，建议继续阅读：

- [Claude Code高级配置技巧](./0107.claude-code-advanced-config.md)
- [Claude Code实用操作手册](./0108.claude-code-operation-manual.md)
- [Claude Code CLI完全指南](./0109.claude-code-cli-guide.md)

## 参考资源

- [Claude Code官方文档](https://docs.claude.com/en/docs/claude-code/setup)
- [Anthropic API文档](https://docs.anthropic.com/claude/reference)
- [GitHub仓库](https://github.com/anthropics/claude-code)

> 💡 **提示**: 遇到问题时，可以先运行 `claude /doctor` 来获取系统状态信息，这通常能帮助定位问题所在。