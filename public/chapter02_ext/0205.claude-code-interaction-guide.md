# Claude Code 交互模式与快捷键指南

> 精通Claude Code交互模式，掌握键盘快捷键、Vim模式、多行输入和效率提升技巧

## 目录导航

1. [键盘快捷键大全](#1-键盘快捷键大全)
2. [Vim模式使用](#2-vim模式使用)
3. [多行输入技巧](#3-多行输入技巧)
4. [命令历史管理](#4-命令历史管理)
5. [效率提升技巧](#5-效率提升技巧)

## 1. 键盘快捷键大全

### 1.1 基础控制快捷键

| 快捷键 | 描述 | 使用场景 |
|--------|------|----------|
| `Ctrl + C` | 取消当前输入或生成 | 当Claude输出过长或方向错误时立即停止 |
| `Ctrl + D` | 退出Claude Code会话 | 正常结束对话 |
| `Ctrl + L` | 清除终端屏幕 | 清理界面但保留对话历史 |
| `↑ / ↓` | 浏览命令历史 | 回忆和重用之前的输入 |
| `Esc + Esc` | 编辑上一条消息 | 快速修改刚发送的内容 |

### 1.2 特殊功能快捷键

#### 快速命令

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `#` (行首) | 内存快捷方式 | 快速添加内容到CLAUDE.md |
| `/` (行首) | 斜线命令 | 查看和执行斜线命令 |
| `@` | 文件引用 | 引用项目中的文件 |
| `!` | Shell命令 | 执行系统命令 |
| `Tab` | 自动补全 | 补全文件路径和命令 |

#### 多行输入

| 快捷键 | 平台 | 描述 |
|--------|------|------|
| `\ + Enter` | 所有平台 | 通用多行输入方式 |
| `Option + Enter` | macOS | macOS默认多行输入 |
| `Shift + Enter` | 配置后 | 需要先运行 `/terminal-setup` |
| `直接粘贴` | 所有平台 | 粘贴代码块自动进入多行模式 |

### 1.3 权限和模式快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Shift + TAB` | 权限控制 | 在聊天中动态调整权限 |
| `Shift + TAB` x2 | 计划模式 | 进入只读的分析模式 |
| `Ctrl + V` | 粘贴图片 | 直接粘贴截图或设计稿 |
| `Ctrl + Shift + V` | 粘贴格式化文本 | 保留格式的文本粘贴 |

### 1.4 导航快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Home` | 跳到行首 | 快速移动到当前行开始 |
| `End` | 跳到行尾 | 快速移动到当前行结束 |
| `Ctrl + A` | 全选 | 选择当前输入的所有内容 |
| `Ctrl + K` | 删除到行尾 | 从光标位置删除到行尾 |
| `Ctrl + U` | 删除到行首 | 从光标位置删除到行首 |

## 2. Vim模式使用

### 2.1 模式切换

| 命令 | 功能 | 从模式 |
|------|------|--------|
| `Esc` | 进入普通模式 | 插入模式 |
| `i` | 在光标前插入 | 普通模式 |
| `I` | 在行首插入 | 普通模式 |
| `a` | 在光标后插入 | 普通模式 |
| `A` | 在行尾插入 | 普通模式 |
| `o` | 在下方打开新行 | 普通模式 |
| `O` | 在上方打开新行 | 普通模式 |

### 2.2 导航命令（普通模式）

#### 基础移动

| 命令 | 移动方向 |
|------|----------|
| `h` | 向左移动一个字符 |
| `j` | 向下移动一行 |
| `k` | 向上移动一行 |
| `l` | 向右移动一个字符 |

#### 词级导航

| 命令 | 移动方式 |
|------|----------|
| `w` | 移动到下一个单词开头 |
| `e` | 移动到当前单词结尾 |
| `b` | 移动到上一个单词开头 |
| `ge` | 移动到上一个单词结尾 |

#### 行级导航

| 命令 | 移动位置 |
|------|----------|
| `0` | 行首 |
| `$` | 行尾 |
| `^` | 第一个非空白字符 |
| `gg` | 文件开头 |
| `G` | 文件结尾 |
| `:n` | 跳转到第n行 |

### 2.3 编辑命令（普通模式）

#### 删除操作

| 命令 | 删除范围 |
|------|----------|
| `x` | 删除当前字符 |
| `X` | 删除前一个字符 |
| `dd` | 删除当前行 |
| `D` | 删除到行尾 |
| `dw` | 删除到下一个单词 |
| `de` | 删除到单词结尾 |
| `db` | 删除到单词开头 |
| `dgg` | 删除到文件开头 |
| `dG` | 删除到文件结尾 |

#### 修改操作

| 命令 | 修改范围 |
|------|----------|
| `cc` | 替换整行 |
| `C` | 修改到行尾 |
| `cw` | 修改当前单词 |
| `ce` | 修改到单词结尾 |
| `cb` | 修改到单词开头 |
| `s` | 替换当前字符并进入插入模式 |
| `S` | 替换整行并进入插入模式 |

#### 复制和粘贴

| 命令 | 操作 |
|------|------|
| `yy` | 复制当前行 |
| `yw` | 复制当前单词 |
| `y$` | 复制到行尾 |
| `p` | 在光标后粘贴 |
| `P` | 在光标前粘贴 |

#### 撤销和重做

| 命令 | 操作 |
|------|------|
| `u` | 撤销上一步操作 |
| `Ctrl + r` | 重做 |
| `.` | 重复上一次修改 |

### 2.4 搜索和替换

#### 搜索

| 命令 | 功能 |
|------|------|
| `/pattern` | 向前搜索 |
| `?pattern` | 向后搜索 |
| `n` | 下一个匹配项 |
| `N` | 上一个匹配项 |
| `*` | 搜索光标下的单词 |
| `#` | 反向搜索光标下的单词 |

#### 替换

| 命令 | 功能 |
|------|------|
| `:s/old/new` | 替换当前行第一个匹配项 |
| `:s/old/new/g` | 替换当前行所有匹配项 |
| `:%s/old/new` | 替换文件中每行第一个匹配项 |
| `:%s/old/new/g` | 替换文件中所有匹配项 |

## 3. 多行输入技巧

### 3.1 启用多行输入

#### 方法1：反斜杠换行

```bash
# 输入多行查询
帮我分析这段代码的性能问题： \
function findUser(id) { \
    for (let i = 0; i < users.length; i++) { \
        if (users[i].id === id) { \
            return users[i]; \
        } \
    } \
} \
\# 这个算法的时间复杂度是多少？
```

#### 方法2：配置Shift+Enter

```bash
# 首先启用Shift+Enter多行输入
claude /terminal-setup

# 然后可以使用Shift+Enter换行
请帮我：
1. 创建一个React组件
2. 添加TypeScript类型
3. 编写单元测试
```

#### 方法3：直接粘贴

```bash
# 直接复制粘贴代码块
const complexFunction = async (params) => {
    try {
        const result = await fetchData(params);
        const processed = processData(result);
        return processed;
    } catch (error) {
        handleError(error);
        throw error;
    }
};
```

### 3.2 多行输入最佳实践

#### 代码分析

```bash
# 分析复杂代码结构
请分析这个类的设计模式：
class UserService {
    constructor(database, logger, validator) {
        this.db = database;
        this.logger = logger;
        this.validator = validator;
    }

    async createUser(userData) {
        // 验证输入
        if (!this.validator.isValid(userData)) {
            throw new Error('Invalid user data');
        }

        // 创建用户
        const user = await this.db.create(userData);

        // 记录日志
        this.logger.info(`User created: ${user.id}`);

        return user;
    }
}
```

#### 复杂查询

```bash
# 多步骤任务描述
请帮我完成以下任务：
1. 首先分析当前项目的结构
2. 识别性能瓶颈
3. 提出优化建议
4. 创建优化方案文档

重点关注：
- API响应时间
- 数据库查询效率
- 前端渲染性能
```

## 4. 命令历史管理

### 4.1 浏览历史

#### 基础导航

```bash
# 使用方向键
↑  # 上一个命令
↓  # 下一个命令

# 在历史中搜索
Ctrl + R  # 反向搜索历史
Ctrl + S  # 正向搜索历史
```

#### 高级历史操作

```bash
# 历史命令快捷键
!!        # 执行上一个命令
!-n       # 执行倒数第n个命令
!n        # 执行历史中第n个命令
!string   # 执行最近以string开头的命令
!?string  # 执行最近包含string的命令
```

### 4.2 历史搜索

#### 交互式搜索

```bash
# 开始搜索
Ctrl + R

# 输入搜索内容
(reverse-i-search)`claude`: claude /init

# 继续搜索
Ctrl + R  # 下一个匹配
Ctrl + S  # 上一个匹配
```

#### 历史命令重用

```bash
# 修改并执行上一个命令
^old^new  # 替换上一个命令中的old为new

# 示例
claude -p "分析代码"
^代码^配置文件  # 执行：claude -p "分析配置文件"
```

### 4.3 历史持久化

#### 配置历史保存

```bash
# 在 ~/.zshrc 或 ~/.bashrc 中添加
export HISTSIZE=10000  # 内存中保存的历史命令数
export HISTFILESIZE=50000  # 历史文件中保存的命令数
export HISTCONTROL=ignoredups  # 不保存重复命令
export HISTTIMEFORMAT='%F %T '  # 显示时间戳

# Claude Code 特定历史
export CLAUDE_HISTORY=~/.claude/history
```

#### 历史文件管理

```bash
# 查看历史文件
cat ~/.claude/history

# 搜索历史
grep "特定内容" ~/.claude/history

# 清理历史
echo > ~/.claude/history
```

## 5. 效率提升技巧

### 5.1 快速输入技巧

#### Tab补全

```bash
# 文件路径补全
@src/comp<TAB>  # 补全为 @src/components/

# 命令补全
/term<TAB>      # 补全为 /terminal-setup

# Git命令补全
!git ch<TAB>    # 补全为 !git checkout
```

#### 别名和函数

```bash
# 在 ~/.zshrc 中创建别名
alias cc='claude'
alias cci='claude /init'
alias ccr='claude /review'
alias ccd='claude /doctor'

# 创建函数
cc-review() {
    claude -p "审查这些文件: $*"
}

cc-gen-doc() {
    claude /init && claude -p "生成 $1 的文档"
}
```

### 5.2 会话管理技巧

#### 会话恢复

```bash
# 快速恢复工作
alias cc-last='claude --continue'

# 恢复特定类型的会话
cc-review() {
    local session=$(claude /resume | grep "review" | head -1 | awk '{print $1}')
    claude --resume "$session"
}
```

#### 会话标记

```bash
# 在对话中添加标记
> # TASK: 修复登录bug
> # TODO: 优化数据库查询
> # NOTE: 记得添加错误处理

# 搜索特定标记
Ctrl + R 然后输入 # TASK
```

### 5.3 权限管理技巧

#### 预设权限组

```bash
# 开发模式
claude --allowedTools "Bash(npm*)" "Read(*)" "Write"

# 只读模式
claude --allowedTools "Read(*)" --disallowedTools "Bash(*)" "Write"

# 审查模式
claude --allowedTools "Read(*)" "Bash(git diff)" "Bash(git log)"
```

#### 动态权限调整

```bash
# 临时提升权限
Shift + TAB  # 添加需要的权限

# 快速禁用危险操作
Shift + TAB  # 禁用 Bash(rm*) Bash(sudo*)
```

### 5.4 自动化工作流

#### 快速模板

```bash
# 创建代码审查模板
echo "请审查以下方面的代码质量：
- 代码规范性
- 性能优化
- 安全性问题
- 可维护性
- 测试覆盖率" > ~/.claude/templates/review.txt

# 使用模板
claude -p "$(cat ~/.claude/templates/review.txt) @src/components/"
```

#### 批量操作

```bash
# 批量分析文件
for file in src/components/*.tsx; do
    claude -p "分析组件 $file 的性能问题"
done

# 批量生成测试
claude -p "为以下文件生成测试用例：
$(find src -name "*.service.ts" | tr '\n' ' ')"
```

### 5.5 高级技巧

#### 多任务并行

```bash
# 在不同终端窗口中
# Terminal 1: 代码审查
claude --resume review-session

# Terminal 2: 文档生成
claude -p "生成API文档" > docs.md

# Terminal 3: 测试运行
npm test | claude -p "分析测试结果"
```

#### 智能上下文

```bash
# 使用CLAUDE.md提供上下文
> # 项目：电商后台管理系统
> # 技术栈：React + TypeScript + Node.js
> # 当前任务：优化用户管理模块

> 基于以上信息，请帮我分析 @src/admin/UserManager.tsx
```

## 高级配置

### 自定义快捷键

```bash
# 在 ~/.zshrc 中添加自定义键绑定
bindkey '^X^C' 'claude /clear'  # Ctrl+X Ctrl+C 清除会话
bindkey '^X^R' 'claude /review'  # Ctrl+X Ctrl+R 代码审查
```

### 终端优化

```bash
# 提升终端响应速度
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1
export BASH_DEFAULT_TIMEOUT_MS=30000

# 优化显示
export CLAUDE_THEME=dark
export CLAUDE_CODE_MAX_OUTPUT_TOKENS=4096
```

## 下一步

掌握交互模式后，建议继续学习：

- [Claude Code斜线命令详解](./0111.claude-code-slash-commands.md)
- [Claude Code全局配置与设置](./0112.claude-code-global-settings.md)

## 参考资源

- [Vim教程](https://www.vim.org/docs.php)
- [终端快捷键指南](https://www.hamvocke.com/blog/a-quick-guide-to-tmux/)
- [Shell脚本技巧](https://google.github.io/styleguide/shellguide.html)

> 💡 **提示**: 练习使用Vim模式可以大大提高代码编辑效率。建议先从基础的移动命令开始，逐步学习更复杂的编辑命令。使用 `/vim` 命令可以随时开启或关闭Vim模式。