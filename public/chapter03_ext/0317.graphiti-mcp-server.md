# Graphiti MCP Server - AI知识图谱服务器

> 一个强大的AI代理知识图谱服务器，使用Neo4j构建并与模型上下文协议(MCP)集成，提供智能知识管理和检索功能

## 目录导航

1. [什么是 Graphiti MCP Server？](#1-什么是-graphiti-mcp-server)
2. [核心功能特性](#2-核心功能特性)
3. [系统架构](#3-系统架构)
4. [安装指南](#4-安装指南)
5. [配置说明](#5-配置说明)
6. [使用方法](#6-使用方法)
7. [知识图谱操作](#7-知识图谱操作)
8. [故障排除](#8-故障排除)

## 1. 什么是 Graphiti MCP Server？

Graphiti MCP Server 是一个专门为 AI 代理设计的知识图谱服务器，结合了图数据库 Neo4j 的强大能力和模型上下文协议 (MCP) 的标准化接口。它提供了一个智能的知识管理和检索系统，让 AI 代理能够更好地理解、组织和利用知识。

### 核心价值

- **知识图谱**：构建和管理结构化的知识网络
- **语义检索**：基于语义关系的智能知识检索
- **MCP集成**：标准化接口，易于集成到各种AI系统
- **可扩展性**：支持大规模知识图谱的存储和查询
- **实时更新**：支持知识的动态更新和演化

### 设计理念

Graphiti MCP Server 遵循现代知识管理和 AI 系统设计的最佳实践：
- **图结构思维**：将知识表示为节点和关系的网络
- **语义优先**：强调知识的语义含义和关联
- **标准化接口**：使用 MCP 协议确保互操作性
- **性能优化**：针对大规模知识图谱的查询优化

## 2. 核心功能特性

### 🕸️ 知识图谱构建
- **自动知识抽取**：从文本中自动抽取实体和关系
- **图谱构建**：构建结构化的知识图谱
- **关系推理**：基于已有关系推理新的关联
- **知识融合**：融合来自多个知识源的信息

### 🔍 智能检索
- **语义搜索**：基于语义而非关键词的搜索
- **路径查询**：查找知识节点间的关联路径
- **相似性分析**：分析知识的相似度和关联度
- **上下文检索**：基于上下文的相关知识检索

### 📊 可视化分析
- **图谱可视化**：直观展示知识图谱结构
- **关系网络**：可视化实体间的复杂关系
- **知识统计**：统计知识图谱的各项指标
- **趋势分析**：分析知识演化和发展趋势

### 🔄 实时更新
- **增量更新**：支持知识图谱的增量更新
- **变更追踪**：追踪知识的变更历史
- **一致性维护**：维护知识图谱的一致性
- **版本管理**：支持知识图谱的版本管理

### 🛡️ 安全与隐私
- **访问控制**：细粒度的知识访问权限控制
- **数据加密**：敏感知识的加密存储
- **审计日志**：完整的操作审计日志
- **隐私保护**：个人隐私信息的保护机制

### 🚀 高性能
- **分布式架构**：支持分布式部署和扩展
- **查询优化**：针对图查询的专门优化
- **缓存机制**：智能缓存提高查询性能
- **并发处理**：高并发请求的处理能力

## 3. 系统架构

### 技术架构
```
AI Agents (Claude Code, etc.)
    ↓
MCP Protocol Layer
    ├── Request Router
    ├── Auth Manager
    └── Rate Limiter
    ↓
Graphiti MCP Server
    ├── Knowledge Engine
    ├── Query Processor
    ├── Graph Builder
    └── API Manager
    ↓
Neo4j Database
    ├── Knowledge Graph
    ├── Relationship Data
    └── Index Tables
```

### 核心组件

#### Knowledge Engine（知识引擎）
- **实体识别**：识别和分类文本中的实体
- **关系抽取**：抽取实体间的语义关系
- **知识融合**：融合多源知识信息
- **推理机制**：基于规则的推理引擎

#### Query Processor（查询处理器）
- **查询解析**：解析和优化查询请求
- **语义理解**：理解查询的语义意图
- **结果排序**：对查询结果进行相关性排序
- **缓存管理**：管理查询结果缓存

#### Graph Builder（图谱构建器）
- **节点管理**：创建和管理知识节点
- **关系管理**：建立和维护知识关系
- **模式定义**：定义知识图谱的模式
- **数据验证**：验证知识数据的正确性

#### API Manager（API管理器）
- **接口管理**：管理 MCP API 接口
- **协议适配**：适配 MCP 协议规范
- **错误处理**：处理API错误和异常
- **性能监控**：监控 API 性能指标

## 4. 安装指南

### 4.1 系统要求

#### 最低要求
- **操作系统**：Linux (Ubuntu 20.04+), macOS 11+, Windows 10+
- **处理器**：4核心 CPU
- **内存**：8GB RAM
- **存储空间**：50GB 可用空间
- **网络**：稳定的互联网连接

#### 推荐配置
- **操作系统**：Linux (Ubuntu 22.04+), macOS 12+, Windows 11+
- **处理器**：8核心或更多 CPU
- **内存**：16GB RAM 或更多
- **存储空间**：100GB 可用空间
- **网络**：高速宽带连接

#### 依赖服务
- **Neo4j**：5.0+ 或 Neo4j AuraDB
- **Docker**：20.10+（可选）
- **Node.js**：18.0.0+ 或 Python 3.9+
- **Redis**：6.0+（可选，用于缓存）

### 4.2 安装方式

#### 方式1：Docker Compose 部署
```bash
# 克隆仓库
git clone https://github.com/gifflet/graphiti-mcp-server.git
cd graphiti-mcp-server

# 启动服务（包含 Neo4j）
docker-compose up -d

# 验证安装
curl http://localhost:8080/health
```

#### 方式2：独立部署
```bash
# 安装 Neo4j
# 参考官方文档：https://neo4j.com/docs/

# 克隆并构建 Graphiti
git clone https://github.com/gifflet/graphiti-mcp-server.git
cd graphiti-mcp-server

# 安装依赖
npm install

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件

# 启动服务
npm start
```

#### 方式3：源码开发
```bash
# 克隆仓库
git clone https://github.com/gifflet/graphiti-mcp-server.git
cd graphiti-mcp-server

# 安装开发依赖
npm install

# 启动开发模式
npm run dev

# 运行测试
npm test
```

### 4.3 Neo4j 配置

#### Neo4j Desktop 配置
```bash
# 1. 安装 Neo4j Desktop
# 2. 创建新项目
# 3. 添加数据库（版本 5.0+）
# 4. 设置密码（默认：neo4j/password）
# 5. 启动数据库
```

#### Neo4j Server 配置
```bash
# 下载 Neo4j Server
wget https://neo4j.com/artifact.php?name=neo4j-community-5.0.0-unix.tar.gz

# 解压和配置
tar -xf neo4j-community-5.0.0-unix.tar.gz
cd neo4j-community-5.0.0

# 配置文件
conf/neo4j.conf
# 设置以下配置：
# dbms.default_listen_address=0.0.0.0
# dbms.connector.bolt.listen_address=0.0.0.0:7687
# dbms.security.auth_enabled=true

# 启动服务
bin/neo4j start
```

### 4.4 初始化配置

#### 环境变量配置
```bash
# .env 文件
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password
NEO4J_DATABASE=neo4j

GRAPHITI_SERVER_PORT=8080
GRAPHITI_LOG_LEVEL=info

REDIS_URL=redis://localhost:6379  # 可选
CACHE_TTL=3600  # 缓存过期时间（秒）

MCP_SERVER_NAME=graphiti-mcp
MCP_SERVER_VERSION=1.0.0
```

#### MCP 配置文件
```json
// mcp-config.json
{
  "name": "graphiti-mcp",
  "version": "1.0.0",
  "description": "AI Knowledge Graph Server",
  "capabilities": {
    "tools": [
      "create_entity",
      "create_relationship",
      "search_knowledge",
      "query_graph",
      "visualize_graph"
    ],
    "resources": [
      "knowledge_graph",
      "entity_index",
      "relationship_index"
    ]
  },
  "endpoints": {
    "http": "http://localhost:8080",
    "websocket": "ws://localhost:8080/ws"
  }
}
```

## 5. 配置说明

### 5.1 数据库配置

#### Neo4j 连接配置
```yaml
# config/database.yaml
neo4j:
  uri: "bolt://localhost:7687"
  username: "neo4j"
  password: "password"
  database: "neo4j"

  connection_pool:
    max_size: 50
    connection_timeout: 30000
    max_connection_lifetime: 3600000

  ssl:
    enabled: false
    trust: "TRUST_ALL_CERTIFICATES"
```

#### 知识图谱模式配置
```yaml
# config/schema.yaml
knowledge_schema:
  entities:
    person:
      properties:
        - name: string
        - age: integer
        - email: string
        - created_at: datetime

    company:
      properties:
        - name: string
        - industry: string
        - founded: integer
        - website: string

    project:
      properties:
        - name: string
        - description: string
        - status: string
        - start_date: date

  relationships:
    WORKS_FOR:
      from: person
      to: company
      properties:
        - position: string
        - start_date: date
        - end_date: date

    PARTICIPATES_IN:
      from: person
      to: project
      properties:
        - role: string
        - contribution: string

    OWNS:
      from: company
      to: project
      properties:
        - ownership_percentage: float
```

### 5.2 服务配置

#### 服务器配置
```yaml
# config/server.yaml
server:
  host: "0.0.0.0"
  port: 8080
  workers: 4

  cors:
    enabled: true
    origins: ["*"]

  rate_limiting:
    enabled: true
    requests_per_minute: 1000
    burst_size: 100

  authentication:
    enabled: true
    jwt_secret: "your-jwt-secret"
    token_expiration: 3600
```

#### 缓存配置
```yaml
# config/cache.yaml
cache:
  enabled: true
  type: "redis"  # memory, redis, file

  redis:
    host: "localhost"
    port: 6379
    db: 0
    password: null

  ttl:
    query_result: 300
    entity_data: 600
    relationship_data: 600

  max_size: 10000
```

### 5.3 MCP 协议配置

#### 工具定义
```yaml
# config/tools.yaml
tools:
  create_entity:
    name: "Create Knowledge Entity"
    description: "Create a new entity in the knowledge graph"
    parameters:
      type: string
      properties: object
    required: ["type", "properties"]

  create_relationship:
    name: "Create Relationship"
    description: "Create a relationship between entities"
    parameters:
      from_entity: string
      to_entity: string
      relationship_type: string
      properties: object
    required: ["from_entity", "to_entity", "relationship_type"]

  search_knowledge:
    name: "Search Knowledge"
    description: "Search for entities and relationships"
    parameters:
      query: string
      entity_types: array
      limit: integer
    required: ["query"]

  query_graph:
    name: "Query Graph"
    description: "Execute Cypher query on the knowledge graph"
    parameters:
      cypher_query: string
      parameters: object
    required: ["cypher_query"]

  visualize_graph:
    name: "Visualize Graph"
    description: "Generate visualization of knowledge graph"
    parameters:
      center_node: string
      depth: integer
      layout: string
    required: ["center_node"]
```

## 6. 使用方法

### 6.1 MCP 客户端集成

#### 配置 Claude Code
```json
// ~/.claude/settings.json
{
  "mcpServers": {
    "graphiti": {
      "command": "node",
      "args": ["/path/to/graphiti-mcp-server/dist/index.js"],
      "env": {
        "NEO4J_URI": "bolt://localhost:7687",
        "NEO4J_USER": "neo4j",
        "NEO4J_PASSWORD": "password"
      }
    }
  }
}
```

#### 使用 Claude Code 与 Graphiti 交互
```bash
# 启动 Claude Code
claude

# 在对话中使用 Graphiti 功能
# 例如：
# "请创建一个名为 John Doe 的人物实体，年龄30岁，邮箱 john@example.com"
# "查找所有与人工智能相关的项目"
# "显示 John Doe 参与的项目关系图"
```

### 6.2 直接 API 使用

#### 创建实体
```bash
curl -X POST http://localhost:8080/mcp/tools/create_entity \
  -H "Content-Type: application/json" \
  -d '{
    "type": "person",
    "properties": {
      "name": "Alice Smith",
      "age": 28,
      "email": "alice@example.com",
      "created_at": "2025-12-22T10:00:00Z"
    }
  }'
```

#### 创建关系
```bash
curl -X POST http://localhost:8080/mcp/tools/create_relationship \
  -H "Content-Type: application/json" \
  -d '{
    "from_entity": "Alice Smith",
    "to_entity": "Tech Corp",
    "relationship_type": "WORKS_FOR",
    "properties": {
      "position": "Software Engineer",
      "start_date": "2023-01-15"
    }
  }'
```

#### 搜索知识
```bash
curl -X POST http://localhost:8080/mcp/tools/search_knowledge \
  -H "Content-Type: application/json" \
  -d '{
    "query": "machine learning projects",
    "entity_types": ["project"],
    "limit": 10
  }'
```

### 6.3 图谱查询

#### Cypher 查询
```bash
curl -X POST http://localhost:8080/mcp/tools/query_graph \
  -H "Content-Type: application/json" \
  -d '{
    "cypher_query": "MATCH (p:Person)-[r:WORKS_FOR]->(c:Company) RETURN p, r, c LIMIT 10",
    "parameters": {}
  }'
```

#### 复杂查询示例
```cypher
// 查找参与多个项目的人员
MATCH (p:Person)-[:PARTICIPATES_IN]->(proj:Project)
WITH p, count(proj) as project_count
WHERE project_count > 2
RETURN p.name, project_count
ORDER BY project_count DESC

// 查找技能相似的人员
MATCH (p1:Person)-[:HAS_SKILL]->(s:Skill)<-[:HAS_SKILL]-(p2:Person)
WHERE p1 <> p2
RETURN p1.name, p2.name, collect(s.name) as common_skills
```

### 6.4 可视化功能

#### 生成图谱可视化
```bash
curl -X POST http://localhost:8080/mcp/tools/visualize_graph \
  -H "Content-Type: application/json" \
  -d '{
    "center_node": "Alice Smith",
    "depth": 2,
    "layout": "force_directed"
  }'
```

#### 可视化配置
```json
{
  "nodes": [
    {
      "id": "alice-smith",
      "label": "Alice Smith",
      "type": "person",
      "properties": {
        "age": 28,
        "email": "alice@example.com"
      }
    }
  ],
  "edges": [
    {
      "source": "alice-smith",
      "target": "tech-corp",
      "label": "WORKS_FOR",
      "properties": {
        "position": "Software Engineer"
      }
    }
  ],
  "layout": {
    "type": "force_directed",
    "iterations": 1000
  }
}
```

## 7. 知识图谱操作

### 7.1 知识导入

#### 批量导入实体
```bash
# 从 CSV 文件导入
graphiti import entities --file people.csv --type person

# 从 JSON 文件导入
graphiti import entities --file companies.json --type company
```

#### CSV 文件格式
```csv
# people.csv
name,age,email,created_at
John Doe,35,john@example.com,2025-01-01
Jane Smith,28,jane@example.com,2025-01-15
```

#### 从文本抽取知识
```bash
# 从文档文件抽取
graphiti extract --file document.txt --output entities.json

# 从网页抽取
graphiti extract --url https://example.com --format json
```

### 7.2 知识更新

#### 更新实体属性
```bash
curl -X PUT http://localhost:8080/entities/alice-smith \
  -H "Content-Type: application/json" \
  -d '{
    "properties": {
      "age": 29,
      "position": "Senior Software Engineer"
    }
  }'
```

#### 增量更新关系
```bash
curl -X POST http://localhost:8080/relationships \
  -H "Content-Type: application/json" \
  -d '{
    "from": "alice-smith",
    "to": "new-project",
    "type": "PARTICIPATES_IN",
    "properties": {
      "role": "Lead Developer"
    }
  }'
```

### 7.3 知识分析

#### 图统计分析
```bash
# 获取图谱统计信息
curl http://localhost:8080/analytics/stats

# 分析实体分布
curl http://localhost:8080/analytics/entity-distribution

# 分析关系分布
curl http://localhost:8080/analytics/relationship-distribution
```

#### 路径分析
```bash
# 查找实体间最短路径
curl -X POST http://localhost:8080/analytics/shortest-path \
  -H "Content-Type: application/json" \
  -d '{
    "from": "alice-smith",
    "to": "target-project",
    "max_depth": 5
  }'
```

#### 社区发现
```bash
# 发现知识社区
curl -X POST http://localhost:8080/analytics/communities \
  -H "Content-Type: application/json" \
  -d '{
    "algorithm": "louvain",
    "entity_types": ["person", "project"]
  }'
```

## 8. 故障排除

### 常见问题

#### 1. Neo4j 连接失败
```bash
# 检查 Neo4j 服务状态
systemctl status neo4j

# 测试连接
neo4j-client -u neo4j -p password bolt://localhost:7687

# 检查防火墙设置
sudo ufw status
```

#### 2. MCP 协议错误
```bash
# 验证 MCP 配置
curl http://localhost:8080/mcp/capabilities

# 检查工具可用性
curl http://localhost:8080/mcp/tools

# 查看错误日志
tail -f logs/graphiti.log
```

#### 3. 查询性能问题
```bash
# 分析查询计划
curl -X POST http://localhost:8080/analytics/explain \
  -H "Content-Type: application/json" \
  -d '{
    "cypher_query": "MATCH (n) RETURN count(n)"
  }'

# 检查索引状态
curl http://localhost:8080/admin/indexes

# 创建索引
curl -X POST http://localhost:8080/admin/indexes \
  -H "Content-Type: application/json" \
  -d '{
    "label": "Person",
    "property": "name",
    "type": "btree"
  }'
```

#### 4. 内存使用过高
```bash
# 监控内存使用
curl http://localhost:8080/admin/memory

# 清理缓存
curl -X DELETE http://localhost:8080/admin/cache

# 调整 JVM 参数
export NEO4J_CONF_memory_heap_initial__size=1G
export NEO4J_CONF_memory_heap_max__size=2G
```

### 调试工具

#### 查询调试
```bash
# 启用查询日志
export NEO4J_LOG_QUERY_LEVEL=DEBUG

# 分析慢查询
curl http://localhost:8080/admin/slow-queries

# 查看执行统计
curl http://localhost:8080/admin/query-stats
```

#### 图谱健康检查
```bash
# 检查图谱一致性
curl http://localhost:8080/admin/health/graph

# 验证数据完整性
curl http://localhost:8080/admin/validate

# 修复数据问题
curl -X POST http://localhost:8080/admin/repair
```

## 更新日志

### v1.5.0 (最新)
- 🎉 新增社区发现算法
- ✨ 支持增量知识更新
- 🔧 改进查询性能优化
- 🐛 修复并发访问问题

### v1.4.0
- 🚀 新增知识可视化功能
- ✨ 支持多种数据导入格式
- 🎨 改进用户界面
- 📊 增强分析功能

### v1.3.0
- 💾 新增缓存机制
- 🔍 改进语义搜索
- ⚡ 优化查询性能
- 📚 完善文档

### v1.2.0
- 🔄 支持 MCP 协议集成
- ✨ 新增批量操作功能
- 🎨 重构 API 接口
- 🔧 增强安全性

### v1.0.0
- 🎉 首个公开发布
- ⚡ 基础知识图谱功能
- 🔧 Neo4j 集成
- 📋 REST API 接口

## 贡献指南

欢迎为 Graphiti MCP Server 项目贡献代码！

### 开发环境
```bash
# 克隆仓库
git clone https://github.com/gifflet/graphiti-mcp-server.git
cd graphiti-mcp-server

# 安装开发依赖
npm install

# 启动开发环境
npm run dev

# 运行测试
npm test

# 运行集成测试
npm run test:integration
```

### 代码贡献
1. Fork 项目
2. 创建功能分支
3. 编写测试
4. 提交 Pull Request

### 知识图谱贡献
- 贡献知识模式定义
- 提供知识抽取算法
- 优化查询性能
- 改进可视化效果

## 许可证

本项目采用 Apache 2.0 许可证。详情请参阅 [LICENSE](https://github.com/gifflet/graphiti-mcp-server/blob/main/LICENSE) 文件。

## 相关资源

- [GitHub 仓库](https://github.com/gifflet/graphiti-mcp-server)
- [Neo4j 官方文档](https://neo4j.com/docs/)
- [MCP 协议规范](https://modelcontextprotocol.io/)
- [图数据库教程](https://neo4j.com/developer/graph-database/)
- [用户社区](https://github.com/gifflet/graphiti-mcp-server/discussions)

## 致谢

感谢以下项目和社区的支持：
- [Neo4j](https://neo4j.com/) - 图数据库技术
- [Model Context Protocol](https://modelcontextprotocol.io/) - MCP 协议
- [Claude Code](https://github.com/anthropics/claude-code) - AI 编程助手
- 图数据库社区的支持者们

---

> 💡 **提示**: Graphiti MCP Server 是一个活跃开发的开源项目，如果你觉得有用，请考虑给项目一个 Star，或者参与贡献代码！让 AI 知识管理更加智能和高效！