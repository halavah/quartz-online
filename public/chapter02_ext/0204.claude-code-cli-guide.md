# Claude Code CLI 完全指南

> 深入掌握Claude Code命令行工具，包含CLI命令大全、高频命令分类、启动参数和自动化技巧

## 目录导航

1. [CLI命令大全](#1-cli命令大全)
2. [高频命令分类](#2-高频命令分类)
3. [基础启动参数](#3-基础启动参数)
4. [管道操作技巧](#4-管道操作技巧)
5. [批处理与自动化](#5-批处理与自动化)

## 1. CLI命令大全

### 1.1 基础CLI命令

| 命令 | 描述 | 示例 |
|------|------|------|
| `claude` | 启动交互式REPL模式 | `claude` |
| `claude "query"` | 使用初始提示符启动REPL | `claude "解释这个项目"` |
| `claude -p "query"` | 通过SDK查询后退出 | `claude -p "解释这个函数"` |
| `cat file \| claude -p "query"` | 处理管道输入 | `cat logs.txt \| claude -p "解释"` |
| `claude -c` | 继续最近的对话 | `claude -c` |
| `claude -c -p "query"` | 通过SDK继续对话 | `claude -c -p "检查类型错误"` |
| `claude -r "<session-id>" "query"` | 通过ID恢复会话 | `claude -r "abc123" "完成这个PR"` |
| `claude update` | 更新至最新版本 | `claude update` |
| `claude mcp` | 配置MCP服务器 | `claude mcp` |

### 1.2 CLI标志参数

| 标志 | 描述 | 示例 |
|------|------|------|
| `--add-dir` | 添加额外的工作目录 | `claude --add-dir ../apps ../lib` |
| `--allowedTools` | 允许的工具列表 | `claude --allowedTools "Bash(git*)" "Write"` |
| `--disallowedTools` | 禁止的工具列表 | `claude --disallowedTools "Bash(rm*)"` |
| `--print, -p` | 非交互模式打印响应 | `claude -p "查询"` |
| `--output-format` | 输出格式(text/json/stream-json) | `claude -p "查询" --output-format json` |
| `--input-format` | 输入格式(text/stream-json) | `claude -p --input-format stream-json` |
| `--verbose` | 启用详细日志记录 | `claude --verbose` |
| `--max-turns` | 限制代理轮次 | `claude -p --max-turns 3 "查询"` |
| `--model` | 设置当前会话的模型 | `claude --model claude-sonnet-4` |
| `--permission-prompt-tool` | 权限提示工具 | `claude -p --permission-prompt-tool tool "查询"` |
| `--resume` | 恢复特定会话 | `claude --resume abc123` |
| `--continue` | 加载最近的对话 | `claude --continue` |
| `--dangerously-skip-permissions` | 跳过权限提示 | `claude --dangerously-skip-permissions` |

## 2. 高频命令分类

### 2.1 会话管理类

#### 查看和恢复会话

```bash
# 打开当前目录的聊天记录
claude --resume

# 继续当前目录的上一次聊天
claude -c

# 恢复特定会话ID
claude -r session-abc-123 "继续上次的工作"

# 查看所有会话历史
claude /resume
```

#### 清理和管理

```bash
# 清除终端屏幕，保留对话历史
clear
# 或者在Claude中使用 Ctrl+L

# 清除对话历史
claude /clear

# 压缩会话内容
claude /compact

# 查看token使用情况
claude /cost
```

### 2.2 项目管理类

#### 项目初始化和配置

```bash
# 初始化项目文档
claude /init

# 编辑项目记忆
claude /memory

# 查看项目记忆
claude /memory view

# 查看配置
claude /config

# 系统健康检查
claude /doctor
```

#### 文档和维护

```bash
# 生成或更新项目文档
claude /init

# 检查系统状态
claude /doctor

# 查看账户状态
claude /status

# 报告问题
claude /bug
```

### 2.3 开发工作流类

#### 代码操作

```bash
# 请求代码审查
claude /review

# 查看PR评论
claude /pr_comments

# 运行测试
!npm test

# 构建项目
!npm run build

# Git操作
!git status
!git add .
!git commit -m "feat: 添加新功能"
```

#### 快速操作

```bash
# 赋予全部权限（谨慎使用）
claude -c --dangerously-skip-permissions

# 在聊天中赋予权限
Shift + TAB

# 开启计划模式
Shift + TAB x2

# 选择模型
claude /model

# 引用文件
@filename.js
```

### 2.4 系统和工具类

#### 权限和安全

```bash
# 查看或更新权限
claude /permissions

# 跳过权限提示（危险）
claude --dangerously-skip-permissions

# 允许特定工具
claude --allowedTools "Bash(npm*)" "Read(*)"

# 禁止特定工具
claude --disallowedTools "Bash(rm*)"
```

#### 环境和配置

```bash
# 查看环境变量
!env | grep ANTHROPIC

# 设置环境变量
export ANTHROPIC_MODEL="claude-sonnet-4"

# 配置通知
claude config set --global preferredNotifChannel terminal_bell

# 配置主题
claude config set --global theme dark
```

## 3. 基础启动参数

### 3.1 标准启动方式

```bash
# 直接启动交互模式
claude

# 带初始问题启动
claude "帮我分析这个项目结构"

# 一次性执行并退出
claude -p "解释这个函数"

# 管道输入
cat file.py | claude -p "优化这段代码"
```

### 3.2 高级启动参数

#### 模型选择

```bash
# 使用特定模型启动
claude --model claude-sonnet-4

# 使用Opus处理复杂任务
claude --model claude-opus-4 "设计系统架构"

# 使用Haiku处理简单任务
claude --model claude-haiku-4 "格式化代码"
```

#### 权限管理

```bash
# 预设允许的工具
claude --allowedTools "Bash(npm*)" "Read(*)" "Write"

# 预设禁止的工具
claude --disallowedTools "Bash(rm*)" "Bash(curl*)"

# 跳过所有权限检查
claude --dangerously-skip-permissions
```

#### 工作目录管理

```bash
# 添加多个工作目录
claude --add-dir ../shared ../utils

# 限制访问范围
claude --add-dir ./src ./tests

# 敏感目录保护
claude --disallowedTools "Read(/etc/*)" "Read(~/.ssh/*)"
```

### 3.3 特殊启动模式

#### 计划模式

```bash
# 启用计划模式（适合复杂任务）
claude --plan

# 架构师模式（大型项目）
claude --architect

# 分析模式（只读权限）
claude --plan --allowedTools "Read(*)"
```

#### 调试模式

```bash
# 启用详细日志
claude --verbose

# 输出JSON格式
claude -p "查询" --output-format json

# 限制轮次避免无限循环
claude -p --max-turns 5 "查询"
```

## 4. 管道操作技巧

### 4.1 基础管道操作

#### 输入重定向

```bash
# 文件内容作为输入
cat code.js | claude -p "解释这段代码"

# 日志分析
tail -100 error.log | claude -p "分析这些错误"

# 配置文件解析
cat package.json | claude -p "提取依赖信息"

# Git diff分析
git diff | claude -p "总结代码变更"
```

#### 多步骤管道

```bash
# 组合多个命令
find . -name "*.js" | head -10 | claude -p "分析这些文件"

# Git历史分析
git log --oneline -20 | claude -p "总结最近的提交"

# 测试结果分析
npm test 2>&1 | claude -p "分析测试失败原因"
```

### 4.2 高级管道技巧

#### 格式化管道

```bash
# JSON处理
curl -s https://api.example.com/data | jq . | claude -p "分析这个API响应"

# CSV处理
cat data.csv | claude -p "转换为JSON格式"

# 代码格式化
cat messy.js | claude -p "格式化这段JavaScript代码"
```

#### 批量处理

```bash
# 批量文件处理
for file in *.md; do
    cat "$file" | claude -p "总结这个文档"
done

# 并行处理
find . -name "*.py" | xargs -P 4 -I {} sh -c 'cat {} | claude -p "解释{}"'
```

### 4.3 输出重定向

```bash
# 保存结果到文件
claude -p "生成API文档" > api-docs.md

# 追加模式
claude -p "更新日志" >> changelog.md

# 错误输出重定向
claude -p "分析代码" 2> errors.log

# 同时保存输出和错误
claude -p "完整分析" > output.log 2>&1
```

## 5. 批处理与自动化

### 5.1 Shell脚本集成

#### 自动化脚本示例

```bash
#!/bin/bash
# auto-review.sh - 自动代码审查脚本

echo "开始代码审查..."

# 获取修改的文件
CHANGED_FILES=$(git diff --name-only HEAD~1)

# 审查每个文件
for file in $CHANGED_FILES; do
    if [[ $file =~ \.(js|ts|jsx|tsx)$ ]]; then
        echo "审查文件: $file"
        claude -p "审查这个文件的安全性、性能和最佳实践: $file"
    fi
done

# 生成审查报告
claude -p "基于以上分析生成代码审查报告" > review-report.md

echo "审查完成，报告已生成: review-report.md"
```

#### CI/CD集成

```bash
#!/bin/bash
# ci-check.sh - CI/CD检查脚本

# 安装依赖
npm install

# 运行测试
npm test

# 代码质量检查
claude -p "检查代码质量问题" --allowedTools "Read(*)" > quality-report.txt

# 安全检查
claude -p "进行安全漏洞扫描" > security-report.txt

# 检查是否通过
if grep -q "CRITICAL" quality-report.txt security-report.txt; then
    echo "检查失败，存在严重问题"
    exit 1
else
    echo "所有检查通过"
    exit 0
fi
```

### 5.2 定时任务

#### 定期维护脚本

```bash
#!/bin/bash
# daily-maintenance.sh - 每日维护脚本

# 清理临时文件
find ~/.claude/cache -name "*.tmp" -mtime +7 -delete

# 更新项目文档
claude /init

# 检查依赖更新
npm outdated

# 生成每日报告
claude -p "生成项目状态日报" > daily-report-$(date +%Y%m%d).md

# 发送报告（可选）
# mail -s "项目日报" team@company.com < daily-report-$(date +%Y%m%d).md
```

#### Crontab配置

```bash
# 编辑crontab
crontab -e

# 添加定时任务
# 每天早上9点运行维护脚本
0 9 * * * /path/to/daily-maintenance.sh

# 每周日凌晨2点深度清理
0 2 * * 0 /path/to/weekly-cleanup.sh

# 每小时检查项目状态
0 * * * * cd /project && claude -p "检查项目状态" >> status.log
```

### 5.3 Makefile集成

```makefile
# Makefile
.PHONY: review test docs clean

# 代码审查
review:
	@echo "开始代码审查..."
	@git diff --name-only | xargs claude -p "审查变更的代码"

# 自动化测试
test:
	@npm test
	@claude -p "分析测试结果并生成报告" > test-report.md

# 文档生成
docs:
	@claude /init
	@claude -p "生成完整的API文档" > docs/api.md

# 代码清理
clean:
	@claude -p "清理不必要的文件和代码"
	@npm run clean

# 部署前检查
pre-deploy: review test docs
	@echo "部署前检查完成"
```

### 5.4 高级自动化场景

#### 智能重构助手

```bash
#!/bin/bash
# smart-refactor.sh

TARGET_DIR=$1
PATTERN=$2

if [ -z "$TARGET_DIR" ] || [ -z "$PATTERN" ]; then
    echo "用法: $0 <目录> <模式>"
    exit 1
fi

# 查找需要重构的文件
FILES=$(find "$TARGET_DIR" -name "*$PATTERN*" -type f)

# 生成重构计划
claude -p "分析这些文件并生成重构计划: $FILES" > refactor-plan.md

# 执行重构
for file in $FILES; do
    echo "重构文件: $file"
    claude -p "重构这个文件遵循最佳实践: $file" > "$file.refactored"
done

# 验证重构结果
claude -p "验证重构后的代码质量" *.refactored > refactor-validation.md
```

#### 批量代码生成

```bash
#!/bin/bash
# generate-components.sh

COMPONENT_NAME=$1
if [ -z "$COMPONENT_NAME" ]; then
    echo "用法: $0 <组件名称>"
    exit 1
fi

# 生成组件文件
claude -p "生成React组件 $COMPONENT_NAME，包含TypeScript类型和测试" > "src/components/${COMPONENT_NAME}.tsx"

# 生成样式文件
claude -p "为组件 $COMPONENT_NAME 生成CSS模块样式" > "src/components/${COMPONENT_NAME}.module.css"

# 生成测试文件
claude -p "为组件 $COMPONENT_NAME 生成完整的单元测试" > "src/components/${COMPONENT_NAME}.test.tsx"

# 生成故事文件
claude -p "为组件 $COMPONENT_NAME 生成Storybook故事" > "src/components/${COMPONENT_NAME}.stories.tsx"

echo "组件 $COMPONENT_NAME 生成完成"
```

## 性能优化技巧

### 1. 减少Token使用

```bash
# 使用紧凑模式
claude /compact

# 限制输出长度
claude -p --max-tokens 1000 "简洁的回答"

# 使用更小的模型
claude --model claude-haiku-4 "简单任务"
```

### 2. 批量操作优化

```bash
# 合并多个小任务
claude -p "一次性处理这些文件: file1.js file2.js file3.js"

# 使用通配符批量处理
claude -p "分析所有测试文件: @tests/*.test.js"
```

### 3. 缓存和重用

```bash
# 保存常用提示为别名
alias cc-review='claude -p "进行代码审查"'
alias cc-docs='claude /init'

# 使用会话恢复避免重复初始化
claude --continue
```

## 下一步

掌握CLI命令后，建议继续学习：

- [Claude Code交互模式与快捷键](./0110.claude-code-interaction-guide.md)
- [Claude Code斜线命令详解](./0111.claude-code-slash-commands.md)

## 参考资源

- [Claude Code CLI文档](https://docs.claude.com/en/docs/claude-code/cli)
- [Shell脚本最佳实践](https://google.github.io/styleguide/shellguide.html)
- [自动化工具集成](https://docs.claude.com/en/docs/claude-code/automation)

> 💡 **提示**: 使用 `claude --help` 查看完整的命令行选项列表。在编写自动化脚本时，建议使用 `--allowedTools` 和 `--disallowedTools` 来控制权限，确保安全性。